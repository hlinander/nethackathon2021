{{nethack-343}}}
&&%s&& %s The spell dissipates over the distance! {8011 2006-08-21T18:45:28Z {396 Jayt} Redirecting to [[The spell dissipates over the distance]] #REDIRECT [[The spell dissipates over the distance]]}
&&%s&& %s You're joking! In this weather? {138353 2021-03-07T04:45:10Z {4001279 Umbire the Phantom} Undo revision 138345 by [[Special:Contributions/Actual-nh|Actual-nh]] ([[User talk:Actual-nh|talk]]) Same as previous. The message "'''You're joking! In this weather?'''" is given when you try to cast a targeted spell underwater.{{refsrc|spell.c|973}} Targeted spells are {{spell of|fireball}} and {{spell of|cone of cold}} at Skilled or higher.

==References==

<references/>

{{disambig}}
{{nethack-343}}
[[Category:Messages]]}
&&%s&& %s You're joking {8013 2006-08-21T18:57:27Z {396 Jayt} Redirecting to [[You're joking! In this weather?]] #REDIRECT [[You're joking! In this weather?]]}
&&%s&& %s You had better wait for the sun to come out {84495 2013-05-02T21:19:00Z {4000180 Bcode} redirect by message text (see also [[Plane of Water]] edit) #redirect [[Plane of Water#You had better wait for the sun to come out.]]}
&&%s&& %s Bugs {99437 2015-12-22T03:23:31Z {4000573 Elronnd} Redirect to 3.6 bugs list, not 3.4 #redirect [[Bugs in NetHack 3.6.0]]}
&&%s&& %s Candelabrum {14038 2006-10-15T04:53:02Z {467 Killian} fix double-redirect #REDIRECT [[Candelabrum of Invocation]]}
&&%s&& %s Category:Unique items {8036 2006-08-22T11:32:51Z {396 Jayt} created category This category contains articles about the four [[unique item]]s in NetHack.

[[Category:Artifacts]]}
&&%s&& %s Menorah {14039 2006-10-15T04:53:41Z {467 Killian} fix double-redirect #REDIRECT [[Candelabrum of Invocation]]}
&&%s&& %s Dip {136863 2021-01-07T18:43:32Z {4001463 Actual-nh} /* Dipping examples */ BUC link '''#dip''' is an [[extended command]] used to dip one object into another. It is usually used to dip something (for example [[unicorn horn]]) into a potion, although you can also dip objects into [[fountain]]s and [[pool]]s of water. The most general purpose for dipping into fountains and pools is to turn scrolls and spellbooks into [[blank scroll]]s and [[blank spellbook]]s, and to dilute potions (by dipping once) or create [[potions of water]] (by dipping a diluted potion again).

The player will be prompted, first, for an object to be ''dipped'', then an object to be dipped ''into''. Generally, though with notable exceptions, dipping causes the ''dipped'' object to be affected by the ''into'' object and will consume one ''into'' object, or risk its destruction if a [[fountain]]. Order is important.

When performing [[alchemy]], only 2â€“9 of the dipped potions (determined randomly) will actually be affected. Other forms of dipping, e.g. blessing items with holy water (even stacks of potions), will work on the entire stack.

==Fountains and pools==
In the early game, dipping into [[fountain]]s is the most common method of diluting potions and blanking scrolls and spellbooks. However, unlike pools, fountains eventually dry out. To dip into a pool, you generally must be [[flying]], [[riding]] a flying mount, or wearing [[water walking boots]]. [[Levitation]] won't let you reach the pool. While generally safer than [[quaff]]ing from a fountain, dipping can still cause adverse effects. The safest way is to dig down on a fountain and take a bath in the resulting pools. The fountains in [[Minetown]] should not be used unless all of the watchmen are either dead or locked up in rooms. If a watchman sees you use a fountain, you will ''usually'' be warned. See [[wet]] for more information on effects.

==Dipping examples==

Dipping an object into a [[potion of holy water]] is the most common method of [[BUC|blessing]] an uncursed object (and dipping a cursed object into holy water will remove the curse, although a [[scroll of remove curse]] is usually more efficient). Likewise, dipping an object into a [[potion of unholy water]] will make a blessed object uncursed, and will curse an uncursed object.

Dipping a stack of projectiles ([[dart]]s, [[arrow]]s, or [[crossbow bolt]]s) into a [[potion of sickness]] will poison the stack.

Dipping a [[unicorn horn]] into a [[potion of sickness]] will turn it into a [[potion of fruit juice]], and dipping the horn into a [[potion of confusion]], [[potion of blindness]], or a [[potion of hallucination]] will turn the potion into a potion of water.

Dipping an [[amethyst stone]] into a [[potion of booze]] will turn it into a potion of fruit juice.

Dipping an object into a [[potion of polymorph]] will polymorph the object (including unicorn horns, so use caution).

Dipping an object into an uncursed [[potion of water]] will affect the item the same as would dipping it into a fountain or pool. This is usually a waste, however, as potions of water can be turned to holy water.

Dipping a [[long sword]] into a fountain as a lawful character at experience level 5 or higher is a common way of receiving [[Excalibur]].

Dipping a potion into another potion performs [[alchemy]].

==Messages==

{{Wikipedia|Klein bottle}}
{{message|That is a silly thing to dip into.|You can't dip the object into the one you selected.}}
{{message|That is a potion bottle, not a Klein bottle!|You tried to dip a potion into itself.}}
{{message|Interesting...|You dipped something into a potion to no effect.}}
{{message|A coating wears off the <item>.|You dipped a poisoned item into a potion of healing, extra healing, or full healing.{{refsrc|potion.c|1975|version=NetHack 3.6.0}}}}

{{clear}}

==See also==

*[[Alchemy]]
*[[Fountain]]

{{nethack-343}}
[[Category:Extended commands]]}
&&%s&& %s That is a silly thing to dip into {8041 2006-08-22T11:52:17Z {396 Jayt} Redirecting to [[Dip]] #REDIRECT [[Dip]]}
&&%s&& %s That is a potion bottle, not a Klein bottle {8042 2006-08-22T11:52:40Z {396 Jayt} Redirecting to [[Dip]] #REDIRECT [[Dip]]}
&&%s&& %s That is a potion bottle, not a Klein bottle! {8043 2006-08-22T11:53:06Z {396 Jayt} Redirecting to [[Dip]] #REDIRECT [[Dip]]}
&&%s&& %s Magic cancellation {150344 2023-03-26T06:05:00Z {4001483 Cathartes} /* Common misconceptions */ Does "misconceptions" mean everything here is wrong, or everything here is right?  Rename section, also add upcoming {{For|the effects of a [[wand of cancellation]] or a [[spell of cancellation]]|Cancellation}}
'''Magic cancellation''', or '''MC''' for short, is a property which protects the player from certain non-damage effects caused by a monster attacking and touching the player with some part of its body. Examples include [[poison]] from [[killer bee]] stings, [[lycanthropy]] caused by [[werejackal]] bites, and the [[green slime]]'s [[sliming]] attacks. Such attacks are referred to as ''special melee attacks'' in this article. Having the highest (best) magic cancellation means that only {{frac|10}} of special melee attacks will succeed (assuming they would hit otherwise). This makes magic cancellation a high priority trait. A precise list of the special melee attacks that magic cancellation protects against is provided in the [[#How it works|section below]].

Magic cancellation must not be confused with [[cancellation]] caused by a wand or spell, nor with [[magic resistance]]. See {{sa|Differences from cancellation and magic resistance|sectionsign=true}} for further details.

Your current level of magic cancellation can be verified via any source of [[enlightenment]]; "You are warded" means you have MC1, "You are guarded" is MC2, and "You are protected" is MC3.

==Sources==
The most common source of magic cancellation is [[armor]]. Each piece of armor has a magic cancellation number (MC number) ranging from 0 (worst) to 3 (best). Note that magic cancellation from armor is ''not'' cumulative&mdash;the player's magic cancellation is the maximum of that provided by any single piece of armor worn. This means that if you are wearing a [[chain mail]] with MC 1, ''and'' a [[dwarvish cloak]] with MC 1, then your magic cancellation is still 1.

Magic cancellation can also be granted by [[protection]], either [[intrinsic]] or [[extrinsic]].  Extrinsic protection augments your magic cancellation by 1, to a maximum of 3.  Intrinsic protection or temporary protection from the [[spell of protection]] counts as magic cancellation 1, but doesn't stack with armor sources or extrinsic protection.  The sources of extrinsic protection are the [[ring of protection]], the [[Tsurugi of Muramasa]], and the [[Mitre of Holiness]]; more than one such source provides no additional benefit.  Intrinsic protection is granted when you get an [[AC]] bonus by donating to an [[aligned priest]] or by a [[favor]] when [[pray]]ing.  Intrinsic protection may be lost by a [[gremlin]]'s special attack or eating a [[disenchanter]] corpse; if so, donating the appropriate amount to an aligned priest will restore it, even if it would fail to improve your AC.  [[High priest]]s have extrinsic protection, and [[aligned priest]]s and monsters represented by {{monsym|Angel}} have intrinsic protection.

The following list contains all the sources of magic cancellation:

{|class="wikitable"
!Armor
!Armor type 
!MC
|-
|Extrinsic protection
|style="text-align:center" rowspan="3" |N/A
|style="text-align:center" rowspan="1" |+1 (max 3)
|-
|Intrinsic protection
|style="text-align:center" rowspan="2" |1 (if no extrinsic)
|-
|[[spell of protection]]
|-
|[[alchemy smock]]
|style="text-align:center" rowspan="9" |[[cloak]]
|style="text-align:center" rowspan="20" |1
|-
|-
|[[cloak of displacement]]
|-
|-
|[[cloak of invisibility]]
|-
|-
|[[cloak of magic resistance]]
|-
|-
|[[dwarvish cloak]]
|-
|-
|[[elven cloak]]
|-
|-
|[[leather cloak]]
|-
|-
|[[mummy wrapping]]
|-
|-
|[[orcish cloak]]
|-
|-
|[[banded mail]]
|style="text-align:center" rowspan="10" |[[body armor]]
|-
|[[bronze plate mail]]
|-
|-
|[[chain mail]]
|-
|-
|[[leather armor]]
|-
|-
|[[orcish chain mail]]
|-
|-
|[[orcish ring mail]]
|-
|-
|[[ring mail]]
|-
|-
|[[scale mail]]
|-
|-
|[[splint mail]]
|-
|-
|[[studded leather armor]]
|-
|-
|[[cornuthaum]]
|style="text-align:center" rowspan="1" |[[helm]]
|-
|-
|[[oilskin cloak]]
|style="text-align:center" rowspan="2" |[[cloak]]
|style="text-align:center" rowspan="6" |2
|-
|[[robe]]
|-
|-
|[[crystal plate mail]]
|style="text-align:center" rowspan="4" |[[body armor]]
|-
|[[dwarvish mithril-coat]]
|-
|-
|[[elven mithril-coat]]
|-
|-
|[[plate mail]]
|-
|-
|[[cloak of protection]]
|style="text-align:center" rowspan="1" |[[cloak]]
|style="text-align:center" rowspan="1" |3
|-
|}

{{upcoming|NetHack 3.7.0|A worn [[amulet of guarding]] adds +2 to magic cancellation.}}

==Mechanics==
Magic cancellation protects the player by reducing the ''probability'' of special melee attacks occurring.
* The attack must first hit the player. This means passing the player's [[armor class]]. Unless you are [[resistant]] to the damage type of the attack, you will be dealt damage, which reduces your [[hitpoints]]. This occurs regardless of whether the damage type was ordinary physical, or a special type such as [[poison]].
* After this, there is a probability of special effects occurring, for instance:
** 100% [[Sticking attack|Sticking-to]], [[teleport]], [[sliming]], [[disenchanting]], [[disease]]
** {{frac|3}}  [[Drain level]] and [[paralysis]]
** {{frac|4}}  [[Lycanthropy]], [[slowing attack]], and [[drain energy]]
** {{frac|5}}  [[Sleep]]
** {{frac|8}}  [[Poison]]
* The monster itself must not be [[cancellation|cancelled]]{{refsrc|src/mhitu.c|892|version=NetHack 3.6.0}}.
* Finally, the attack must pass the player's magic cancellation aura. The chance of this happening is 1 &minus; 0.3Ã—MC, or listed in the table below:

{|class="wikitable"
! MC !! Effect probability
|-
| 0 || 100%
|-
|1 || 70%
|-
|2 || 40%
|-
|3 || 10%
|}

If all these tests are passed, the player will suffer the special effect. In the case of [[fire]], [[cold]], and [[shock]], there is further a test for determining if any inventory items are damaged or destroyed.

===Cancelable effects===
Understanding how magic cancellation works requires some understanding of how an attack works in NetHack. An attack has two characteristics: ''attack type'' (e.g. bites and stings) and ''damage type'' (e.g. physical or poisonous). A [[soldier ant]], for instance, has two attacks: a bite which does 2d4 physical damage (i.e. ordinary damage), and a sting which does 3d4 [[poison]] damage. Magic cancellation will ''not'' protect against the 2d4 physical damage from the bite, ''nor'' will it prevent the 3d4 damage caused by the sting. It will, however, protect against the special effects from the [[poison]]ous sting, which randomly include [[hitpoint]] reduction, [[attribute]] reduction, and [[instadeath]].

There is no obvious pattern to what magic cancellation does and doesn't protect against. Shortly put, magic cancellation protects against ''certain'' attack types that deal a ''certain'' type of damage. This relation is shown in the table below. To be prevented by magic cancellation, both the attack type and damage type must be in the <span style="background-color:#ffdead;">orange area</span> of the table. If either the attack type or damage type is outside the orange area, magic cancellation will have ''no effect'' on the attack.

In earlier versions of the game, the idea was that some types of armor covered your entire body surface, so the attacker effectively could not touch you despite his successful attack. Over time, with the addition of the [[cornuthaum]] and many types of special attacks, this point has become moot, and the current explanation can only be "it's magic".

{|class="wikitable"
!colspan="2"|Attack type
!colspan="2"|Damage type
|-
!style="width:25%"|Attack type unaffected
!width="250px" style="background:#ffdead; width:25%"|Attack type prevented
!width="250px" style="background:#ffdead; width:25%"|Damage type prevented
!style="width:25%"|Damage type unaffected
|-
|valign="top"|
* [[Passive attack]]s
* Spitting attacks
* [[Engulfing attack]]s
* [[Breath attack]]s
* [[Explosion]]s from proximity
* [[Explosion]]s from dying
* [[Gaze attack]]s
* [[Magic spell]]s
* [[Ranged weapon]] attacks<ref group="note" name="melee_only"/>
|valign="top" style="background:#ffdead;"|
* Claw
* Bite
* Kick<ref group="note" name="never_applies"/>
* Head butt<ref group="note" name="never_applies"/>
* Touch
* Sting
* Tentacle attack<ref group="note" name="never_applies"/>
* [[Holding attack]]s<ref group="note" name="never_applies"/>
* Melee weapon attacks<ref group="note" name="melee_only"/>
|valign="top" style="background:#ffdead;"|
* [[Fire]] (burns scrolls and boils potions)
* [[Cold]] (shatters potions)
* [[Shock]] (detonates rings and wands)
* [[Sleep]] (completely immobilized)
* [[Poison]] (hitpoint and attribute reduction, [[instadeath]])
* [[Paralysis]] (player completely immobilized)
* [[Drain life]] (player loses levels)
* [[Sticky attack]] (inability to move to another square)
* [[Lycanthropy]] (player regularly changes form)
* [[Slowing attack]] (reduces player speed)
* [[Teleport]] (randomly teleports player)
* [[Sliming]] (kills player in a few turns)
* [[Disenchanting]] (reduces enchantment on items)
* [[Dexterity]]- or [[constitution]]-draining [[poison]]
* [[Power]] draining (reduces power)
|valign="top"|
* Ordinary physical
* [[Magic missile]]
* [[Disintegration]]
* [[Acid]]
* [[Blind]]ing
* [[Stun]]ning
* Leg damage by [[xan]]s
* [[Petrification]]
* [[Gold stealing]] effects by [[leprechaun]]s
* [[Item stealing]]
* [[Erosion]] (including rust, rot, and corrosion)
* [[Confusion]]
* [[Digestion]]
* [[Healing]] effects by [[nurse]]s
* [[Drowning]]
* [[Intelligence drain]]
* [[Disease]] effect by [[Juiblex]]
* [[Seduction]]
* [[Hallucination]]
* [[Amulet stealing]] by the [[Wizard of Yendor]]
* [[Intrinsic-stealing]] by [[gremlin]]s
* Random [[clerical spell]], [[magic spell]] or [[breath weapon]] damage
* Special damage of the [[Riders]]
|-
!Examples &ndash; unaffected due to attack type
!style="background:#ffdead;" colspan="2"|Examples &ndash; prevented due to combination of attack type and damage type
!Examples &ndash; unaffected due to damage type
|-
|valign="top"|
*[[Floating eye]] passive paralysis attack
*[[Disenchanter]] passive disenchanting attack
*[[Guardian naga]] spitting poison
*[[Ice vortex]] engulfing cold
*[[Red dragon]] fire breath
*[[Yellow light]] blinding explosion
*[[Medusa]] petrifying gaze
*[[Pyrolisk]] fire gaze
*[[Lich]] magic spells
|valign="top" style="background:#ffdead;" colspan="2"|
* [[Fire]] damage from a [[fire ant]] bite
* [[Cold]] damage from a [[lich]] touch
* [[Shock]] damage from an [[electric eel]] bite
* [[Sleep]] caused by a [[homunculus]] bite
* [[Poison]] damage from a [[killer bee]] sting
* [[Paralysis]] caused by a [[guardian naga]] bite
* [[Drain life]] by a [[barrow wight]] weapon attack
* [[Sticky attack|Sticking-to]] caused by a [[large mimic]] bite
* [[Lycanthropy]] caused by a [[werejackal]] bite when it is in animal form
* [[Slowing attack|Slowing]] caused by a [[shade]] touch
* [[Teleport]] caused by a [[quantum mechanic]] claw
* [[Sliming]] caused by a [[green slime]] touch
* [[Disenchanting]] by a [[disenchanter]] claw<ref group="note" name="not_passive"/>
* Constitution-draining [[poison]] by a [[rabid rat]] bite
* Dexterity-draining [[poison]] by a [[quasit]] claw
|valign="top"|
*Physical damage due to [[tiger]] claws
*[[Medusa]] petrifying gaze
*[[Raven]] blinding claws
*[[Petrification]] (stoning) due to a [[cockatrice]]'s touch or passive hissing attack
*[[Seduction]] due to [[succubus]] bites
*[[Intelligence drain]] due to [[mind flayer]] tentacle attacks
*[[Purple worm]] engulfing digestion
*[[Drowning]] due to [[giant eel]] wrapping
*[[Hallucination]] caused by a [[black light]] exploding
*[[Erosion]] due to [[brown pudding]] bites
*[[Nymph]] stealing claw
|-
|colspan="4"|
<references group="note">
<ref group="note" name="melee_only">Magic cancellation protects against special melee weapon attacks, such as [[level drain]] from a [[barrow wight]]s weapon, but it does ''not'' protect against weapons that are thrown or launched, such as [[poisoned]] arrows and darts.</ref>
<ref group="note" name="never_applies">The type of damage done by every single kick, headbutt, tentacle attack, and grabbing attacks in the game are listed in the rightmost column "Damage type unaffected". And hence they all bypass magic cancellation.</ref>
<ref group="note" name="not_passive">[[Disenchantment]] by the [[disenchanter]] claw is prevented, but magic cancellation does not however protect against the [[passive]] disenchanting attack, since passive attacks are listed in the leftmost column "Attack type unaffected".</ref>
</references>
|}

==Differences from cancellation and magic resistance==
{{main|Cancellation|Magic resistance}}

Magic cancellation is distinct from [[cancellation]], which a monster suffers when hit by a [[wand of cancellation|wand]] or [[spellbook of cancellation|spell]] of cancellation. Cancelling a monster completely removes the monster's ability to perform its special melee attacks, while magic cancellation only reduces the probability of those attacks succeeding against the player. Also, the attacks affected by cancelling a monster are not exactly the same as those prevented through magic cancellation. See the article on [[cancellation]] to compare effects.

Magic cancellation is not the same as [[magic resistance]]. Magic resistance is an [[extrinsic]] that protects against [[spell]], [[wand]], and [[trap]] effects and damage.

Magic cancellation is also different from intrinsic [[resistance]]s against [[fire]], [[cold]], and [[shock]] damage. If you suffer fire damage while [[fire resistant]], you won't be dealt hit point damage, but there is still a chance of items such as [[scroll]]s, [[spellbook]]s, and [[potion]]s being destroyed. Magic cancellation on the other hand won't prevent the damage, but it will reduce the probability of item-destroying effects occurring.

==Noteworthy interactions==
* Magic cancellation does ''not'' protect against paralyzing [[passive attacks]] nor [[gaze attack]]s, which include the attacks of [[floating eye]]s and [[Medusa]].
* Magic cancellation ''partially'' protects against [[disenchanter]]s; it prevents the [[disenchantment]] though the claws, but not through the disenchanter's passive attack.
* Magic cancellation does ''not'' protect against the touch nor against the [[cockatrice#Hissing attack|hissing attack]] of the [[cockatrice]]. It is however possible to [[cancellation|cancel]] the cockatrice itself, using a [[wand of cancellation]] or [[spell of cancellation]]. This will remove its ability to petrify by hissing only.
* [[Monster]]s, including [[pet]]s, enjoy magic cancellation from armor just as the player does. This is especially important if you rely on a powerful pet, as monsters cannot gain [[intrinsic]] resistances from [[eat]]ing [[corpse]]s.
{{upcoming|NetHack 3.7.0|Pets can gain intrinsics from eating, though MC is still good for preventing effects that can't be intrinsically resisted.}}

==Strategy==
Magic cancellation is a useful properly which gets more useful the more of it you have; a character with MC3 will suffer only {{frac|4}} as many cancellable attacks as one with MC2. However, its value must be weighed against its opportunity costs. Acquiring MC3 requires a cloak of protection, or one of the MC2 cloaks or suits and a source of extrinsic protection. Armor which provides MC2 or 3 doesn't provide the useful properties of the MC1 magic cloaks or MC0 dragon scale mail. In many cases, it's better to wear the cloak of magic resistance to protect yourself from polymorph traps and death magic, or silver dragon scale mail to protect your wands and rings from lightning. Most cancellable attacks have either resistances to negate them, or countermeasures to reverse their effects (fire for sliming, holy water for lycanthropy, Elbereth to unstick from mimics), so a well-prepared player may find magic cancellation a lower priority than more critical properties.

Magic cancellation only protects from melee attacks, and characters with strong ranged attacks can generally kill the attackers from a distance before they become a threat. Beware of monsters (especially nasties) being summoned to you, though.

If you want MC3, you may want to treat the ring of protection as a situational item, which you equip when a relevant monster appears and then swap out for a more generally useful one when the situation is dealt with. Priests and Samurai get protection from their quest artifacts; other roles must be lawful (at least temporarily) to wish for them.

== History ==
Before version 3.6.0, magic cancellation was more readily available and stronger, and intrinsic or extrinsic protection had no effect on it.  For more details on magic cancellation as it functioned in 3.4.3, see [[Magic cancellation (3.4.3)]].

==References==
<references />
* [[Source:Mhitu.c]]
* [[Source:Monattk.h]]
* [[Source:Monst.c]]
* [[Source:Mthrowu.c]]

==External links==
* [http://www.spod-central.org/~psmith/nh/armr-343.txt armr-343.txt]
* [http://alt.org/nethack/topdeaths.html NAO top types of death]
{{nethack-360|offset=1}}
{{featured}}
[[Category:Armor]]}
&&%s&& %s Quest monster {140899 2021-06-14T05:24:40Z {4001279 Umbire the Phantom} Changed redirect target from [[Quest]] to [[Quest#Monsters]] #REDIRECT [[Quest#Monsters]]}
&&%s&& %s DFV {14966 2006-10-29T20:43:43Z {712 SGrunt} #REDIRECT [[digging for victory]] #REDIRECT [[digging for victory]]}
&&%s&& %s Save scumming {127584 2019-08-30T05:53:15Z {4001313 Ardub23} Remove extra empty line and red link When playing NetHack on a local machine (ie. not on a [[public server]] such as [[NAO]]), it is possible to sidestep the feature that makes the game so difficult: the permanence of death.

The concept of '''save scumming''' is simple: exit NetHack via the Shift-S save command, then copy the saved game from NetHack's [[playground]] to a different directory.  Run NetHack again, and continue playing until you [[die]].  At this point, restore the saved files, copying them back from the temporary directory to the playground, and restart the game.  Assuming the correct files were copied, the game continues as it was.  This process is [[cheating]], especially because the legitimate way to sidestep death is [[explore mode]].

Save scumming can do more than allow a player to avoid death. Indeed, just about any random element (such as which prize lies at the end of [[Sokoban]], or how much damage a monster inflicts this turn) can be sidestepped with save scumming.

==Legitimate uses==

On a few systems, it might be necessary to guard against game or system crashes, because some copies of NetHack lack a working [[recover]] program. An other legitimate use, would be to use save scumming in place of explore mode, while learning how to play.

A variant of save scumming would be to transfer the save file to an other computer. When doing this, beware, that save files aren't compatible between versions or platforms, not even between 32 and 64 bit builds. You must use the same executable, for this to work with no issues.

Specifically, if you are transfering from a 32bit linux to it's 64bit version. It's easier to just install the 32bit version of nethack in the 64bit system. In ubuntu that can easily be done with 

 sudo apt-get install nethack:i386

For more different platform, you'll need compatibility layers if available, or even full blown emulation.

== Criticism ==
=== Experience ===
NetHack is designed so that death is permanent (except for the [[amulet of life saving]], of course). This adds difficulty to the game, but also adds depth. When making a mistake might cost a week of gameplay, one thinks longer about each action, and investigates more fully the possible repercussions. It also adds excitement: taking risks with a carefully cultivated [[player|character]] becomes more exhilarating when the stakes are higher.

=== Player skills ===
While savescumming may allow a new player to go farther in the dungeon than he or she has before, it will ultimately create a weaker [[player]] than if he or she had toughed it out. By saving and restoring games, the savescummer avoids the learning of the intricacies of NetHack, and will never learn the art of extracting him or herself from difficult positions. Death is part of the game, and a player who savescums to avoid death is not truly playing NetHack. NetHack is like playing several games of chess at the same time. Save scumming is like setting up the board so that you will win without having to think about anything at all. The ONLY reason you should back up your games is to avoid losing whole weeks of characters due to system crashes.

There are some cases where saving a game at a difficult choke point and then playing through multiple ways, trying to find a solution, can be more enlightening than dying and starting over. If you do this, you should probably not continue and finish the game for the reasons explained in the rest of this article. Using the save-preserving feature of [[explore mode]] may be a preferable means of accomplishing this. Alternatively, you can re-create the situation in a separate [[wizard mode]] game, do the testing which solution is best, and then go back to your original game. This sidesteps the entire "cheating" issue.

There are many roleplaying games that allow you to avoid death by saving and restoring your game. By savescumming, a player is missing out on the true fun of the game, at which point NetHack is far less superior to any other RPG available.

=== But, on the other hand... ===

This wiki is a nest of spoilers designed to smooth over the same bumps and pitfalls that a player may seek to avoid via save scumming. So who are we to judge, eh?

== Methodology ==
The methods by which NetHack saves games differ per version.  Similarly, the saved games are not necessarily compatible between [[version]]s or between platforms.

The easiest way to savescum is to start a brand new game.  Once it is started, examine the directories in which NetHack is storing data and find one with a name similar to "save".  Now save and exit the game.  Examine the directory again, and see what files have appeared.  Make a list of the files and the filename syntax (usually the player name with a number).  Now restart the game and let the character die.  Once again, examine the directory and see which files disappeared.  After doing this you should have a good idea of what files hold the game's information.

One can write scripts to speed this process up.

NetHack provides no way to save a running game, as the game file is only created when you save and exit.

=== On multiuser systems ===
On multiuser [[Unix]] systems, a typical configuration installs NetHack as [[setgid]] so that users are unable to copy save files into NetHack's [[playground]].

However, this problem can be circumvented by running as root and using cp -p which will preserve the permissions to the file.
[[Category:Cheating]]
{{noversion}}}
&&%s&& %s Kick {142416 2021-09-06T23:32:13Z {4001279 Umbire the Phantom}  In ''[[NetHack]]'', you can '''kick''' objects, monsters, and dungeon features using {{kbd|ctrl|d}} (or {{kbd|k}}, if the [[number_pad]] [[option]] is on). Kicking anything (an object, a monster, or a dungeon feature) makes [[noise]] that wakes up nearby monsters and attracts pets.

Some monsters kick as part of their [[attack]] sequence. If you are [[polymorph]]ed into such a monster, you will kick enemies automatically when you attack them in [[melee]] - you can use the kick command if you only want to kick the enemy without using other attacks such as a [[pony]]'s bite or a [[unicorn]]'s headbutt.

[[Monk]]s and [[Samurai]] get a bonus to kicking because of their [[martial arts]] training.

==Restrictions on kicking==
You can't kick if:
* You are [[carrying capacity|carrying too much]] ([[encumbrance|stressed]] or greater).
* You are trapped in a [[pit]], [[web]], or [[bear trap]].
* One of your legs is [[wounded legs|wounded]].
* You are [[polymorph]]ed into a [[Lizard (monster class)|reptile]], a monster that is [[tiny]] or one that lacks legs (e.g. a [[slithy]] creature).

Trying to kick while [[underwater]] has a 50% chance of failing ("Your slow motion kick doesn't hit anything."){{refsrc|src/dokick.c|791|version=NetHack 3.6.0}}

If you kick while [[levitation|levitating]] and hit something (a monster, a wall), you will [[hurtle]] in the opposite direction.

If you are [[riding]], the only thing you can kick is your steed, and the game will ask you if you want to do so. Kicking your steed is one way to make it [[Gallop|temporarily move faster]], but at the cost of reducing its [[tameness]].

==Kicking objects==
If you kick an object, it flies in the direction of kicking, possibly hitting the monsters, except the following:

{| class="prettytable"
|-
! Target
! Effect
|-
|Pile of objects
||Only the top object in pile is kicked.
|-
|[[Stack]] of [[gold]]
||Scatters the gold pieces across surrounding tiles.{{refsrc|src/dokick.c|634|version=NetHack 3.6.0}}
|-
|Immobile objects (too heavy, against a wall, fixed in place)
||May wound your leg for a short time, making you unable to kick and reducing your [[carrying capacity]].
|-
|Heavy object
||"Thump!"  The object does not move.  This has a chance of doing damage to you as if you kicked a wall.  Whether the object is heavy or not, determined by it's weight, player's [[strength]], and other factors (see [[#maximal distance]] below).
|-
|[[Fragile]] object
||Causes it to shatter.  If the object is a [[potion]], you will inhale its [[vapors]] and experience their effects.
|-
|Locked [[container]]
||May break the lock.  This is also likely to break fragile items like potions inside it, ("You hear a muffled shatter.") 
|-
|[[Mimic]] disguised as an object
||Reveals the mimic.
|-
|Object embedded in a wall
||May release the object ("The <item> comes loose!") and deposit it on the floor where you are standing.  This is an alternative to [[digging]] the object loose.
|-
|[[Cockatrice corpse]]
||If you are not wearing [[boots]], results in immediate [[stoning]].
|}

Kicking a cursed [[scroll of scare monster]] will not cause it to crumble, as picking it up would.  This is one way to move scrolls that have become cursed.

===Maximal distance===
The distance the kicked object moves is S/2 - W/40{{refsrc|src/dokick.c||version=NetHack 3.6.0}}, where S is the player's strength, W is the object's weight, with the following caveats:
* If the player's strength is 18/01 to 18/31, S=18{{refsrc|src/attrib.c||version=NetHack 3.6.0}}
* If the player's strength is 18/32 to 19 inclusively, S is effectively 20
* Each of the following adds [[rn1|1-3]] to the kicking distance:
** The object is in air (at [[Plane of Air]]) or on ice
** The object is greased, and not underwater or in air
** The player is a Samurai or Monk, wearing [[kicking boots]], or polymorphed to a [[sasquatch]].
* If the object is under water, the distance is D/3 + 1, where D is the distance it would move otherwise.

The distance is ''from the player'', so a distance of 1 or less means that the object does not move at all. In this case it is considered too heavy: the player receives a "Thump!" message and possibly wounds their legs.

Otherwise, the object moves the distance unless stopped by an obstacle.

==Kicking dungeon features==
{{todo|Per [[3.6.3]]: "When players injure themselves kicking an altar, the relevant god's wrath is no longer ignored." This implies significant effects on [[anger]], and the article should be updated accordingly.}}
{| class="prettytable"
|-
! Target
! Effect
|-
|Empty space
||Has a chance of [[Abuse|abusing]] [[strength]] and [[wounded legs|wounding your leg]].  ("Dumb move!  You strain a muscle.")
|-
|Closed [[door]]
||May break the door, leaving an empty doorway.  Breaking a [[shop]] door will anger the [[shopkeeper]] unless you immediately pay 400 zorkmids.  The act of kicking [[exercise]]s [[dexterity]].  Successfully breaking doors exercises [[strength]].
|-
|[[Sink]]
||May create a [[foocubus]] (always of the opposite gender), a [[black pudding]], or a random [[ring]].  Only one of each can come from a given sink.
|-
|[[Altar]]
||With a 1/3 probability, hurts you as if you were kicking a wall. Otherwise, if co-aligned, immediately reduces your [[wisdom]] by one point;  if cross-aligned, reduces [[luck]] by one point. 
|-
|[[Tree]]
||May create some [[fruit]], or a swarm of [[killer bee]]s.  Either event can only happen once per tree.
|-
|[[Throne]]
||May knock loose some [[gold]] and [[gem]]s (only once per throne) or send you to a lower dungeon level.  If the throne has already produced gems and gold or your [[luck]] is negative, kicking may destroy it.
|-
|[[Wall]]
||Does a small amount of damage to you ("Ouch! That hurts!") with a chance of [[wounded legs|hurting your leg]].
|-
|[[Secret door]]
||May reveal the door.  "Crash!  You kick open a secret door!" or "Crash!  You uncover a secret door!"  If your [[luck]] is low, this may be a faster way to make a suspected secret door appear than [[search]]ing.
|}

==Kicking monsters==
Kicking [[monster]]s can damage them.

The base kicking damage is based on your [[Strength|strength]], [[Constitution|constitution]], [[Dexterity|dexterity]] and whether you are wearing [[kicking boots]]. The exact formula is

<math>1d(\frac{Str + Dex + Con}{15} + b)</math>

where <math>b</math> is 5 if wearing kicking boots and 0 otherwise.

Usually, this will come up to 1d7 - 1d8 with kicking boots or 1d2 - 1d3 without.
* If your kick is 'clumsy', this base damage is halved.  (This is not quite the same thing as "Your clumsy kick does no damage", but related.)  Kicks can be clumsy if you are:
** Wearing bulky body armor (dragon scales and dragon scale mail are considered bulky, as is any form of body armor that weighs 350 or more; all other body armors are non-bulky)
** Wearing a [[large shield]], which is also considered bulky
** Carrying a heavy load (more than 70% of your carrying capacity, with higher probability to be clumsy at 80%, and guaranteed at 90%)
** [[Fumbling]]. 
* If you are a [[martial arts|martial artist]] ([[monk]] or [[samurai]]), there is a random damage bonus between 0 and half your [[dexterity]].  This exercises the martial arts skill, but the skill level does not affect the amount of bonus damage.
* If you are wearing [[blessed]] boots, you deal an additional 1d4 damage against [[demon]]s and [[undead]] creatures.
* The enchantment of your boots is added to the total damage amount, plus the enchantment of any [[ring of increase damage|rings of increase damage]] you are wearing or have [[eating jewelry|eaten]].
* [[Thick-skinned]] monsters like [[dragon]]s and [[mumak]]il take no base damage from a kick.  Rings of increase damage, enchanted boots, and blessed boots will still cause their normal damage.{{refsrc|src/dokick.c|49|version=NetHack 3.6.0}}
* If you attempt to kick a [[shade]] with unblessed boots, your foot will pass through it, doing no damage. You can only damage a shade by kicking if your boots are blessed, and even then the only damage comes from the 1d4 bonus versus undead.
If you are [[polymorph]]ed into a [[sasquatch]], you will get a bonus to kicking because you are (a) 'bigfoot'.  

There is a +1 [[to hit]] bonus to kicking, even if you are unskilled in martial arts, so it may be a useful strategy for fighting a monster you are having trouble hitting (like a [[ghost]]).  

Kicking a [[sleep]]ing monster will wake it up. (As usual, the [[noise]] from kicking wakes up all sleeping monsters nearby.)

When [[levitating]], kicking [[monster size|larger]] monsters will propel you farther, and very small monsters will be more difficult to hit.

With the right [[martial arts|training]] or [[kicking boots|equipment]], you can sometimes send smaller monsters reeling back a square&mdash;perhaps into a [[trap]].

===Limitations to kicking monsters===
Kicking monsters can displace them to a random point adjacent to you, even if they couldn't normally reach that spot: "The ''monster'' jumps (or swoops, slides, etc.), nimbly avoiding your kick." This is more likely to happen if you are [[fumbling]] or [[encumbrance|burdened]]. It is also more likely to happen with [[flying]] monsters such as bats.

Kicking a [[cockatrice]] without wearing [[boots]] will result in [[stoning]].

Kicking a [[pet]] is considered [[Tameness#Abuse|abuse]].{{refsrc|src/dokick.c|75|version=NetHack 3.6.0}}

==See also==
* [[Kicking boots]]

==References==
<references/>

{{nethack-360}}
[[Category:Commands]]
[[Category:Monster attacks]]}
&&%s&& %s High priestess of Moloch {14393 2006-10-18T22:11:33Z {0 } Redirecting to [[High priest]] #REDIRECT [[High priest]]}
&&%s&& %s High priest of Moloch {12475 2006-09-26T15:56:54Z {712 SGrunt} #REDIRECT [[High priest]] #REDIRECT [[High priest]]}
&&%s&& %s Wooden flute {149833 2023-02-01T02:00:03Z {4001651 Nethacker1} /* Strategy */ Identification should be under "flute" {{tool
  |color=wood color
  |tile=[[image:flute.png]]
  |name=wooden flute
  |appearance=[[flute]]
  |cost=12
  |weight=5
  |material=wood
}}

The '''wooden flute''' is a [[musical instrument]] in ''[[NetHack]]''. It is a [[tonal instrument]] that shares the same appearance with another [[flute]], the [[magic flute]].

==Effects==
[[Apply]]ing the wooden flute will prompt you to "improvise"; improvising with it will [[exercise]] your [[dexterity]], while choosing not to improvise will let you play a specific set of notes. If the player has enough [[experience]] and dexterity, improvising may make nearby [[snake]]s [[peaceful]]. The snake-charming effect will occur if (1d''Dex'' + Xlvl) is 27 or greater.{{refsrc|music.c|480|nethack=3.6.0|comment=chance of "trilling" and charming snakes}}

When played, it will either "trill" (which pacifies snakes) or "toot".

==Strategy==
The wooden flute is the lightest of all instruments, and a worthwhile candidate to carry to the [[Castle]] to play the [[passtune]]. However, the magic flute weighs the same and is probably a better choice if you can find it, due to its additional effect of putting monsters to [[sleep]].

== References ==
<references/>

[[Category:Musical instruments]]
{{nethack-364}}}
&&%s&& %s Unique monsters {8094 2006-08-23T13:06:39Z {0 } Redirecting to [[Unique monster]] #REDIRECT [[unique monster]]}
&&%s&& %s The Wizard of Yendor {8097 2006-08-23T13:12:36Z {374 Intx13} Redirecting to [[Wizard of Yendor]] #REDIRECT [[Wizard of Yendor]]}
&&%s&& %s Reverse genocide {41691 2009-08-14T11:40:14Z {0 } linked directly to section #REDIRECT [[Genocide#Reverse_genocide]]}
&&%s&& %s Disenchanter {149976 2023-02-16T08:43:22Z {4000251 Netzhack} /* Encyclopedia entry */ Soft line break {{monster
 |difficulty=14
 |level=12
 |experience=301
 |speed=12
 |AC=&minus;10
 |MR=0
 |align=&minus;3
 |frequency=2
 |genocidable=Yes
 |attacks=Claw 4d4 disenchant, [[passive]] disenchant
 |weight=750
 |nutr=200
 |size=Large
 |resistances=None
 |resistances conveyed=None
 |attributes=
{{attributes|A disenchanter|=|hell=1|animal=1|carnivore=1|hostile=1|infravisible=1}}
 |reference=[[monst.c#line1737]]
}}

The '''disenchanter''' is a monster that appears in ''[[NetHack]]''. It is the only other member of the [[{{monclassname|R}}]] class.

Disenchanters are considered to be rather annoying - their sole attack does a decent amount of damage, but more worryingly can decrease the positive [[enchantment]] of its target's worn [[armor]]. In addition, [[weapon]]s and other items used to attack a disenchanter in melee may also have their positive enchantments or charges reduced. [[Artifact]]s have a 90% chance of resisting.

Eating a disenchanter corpse will remove a random [[intrinsic]], as with the [[intrinsic-stealing]] attack used by a [[gremlin]].

==Generation==
Disenchanters are only randomly generated in [[Gehennom]]; the random {{monclasssym|R}} at the [[Castle]] also has a chance to be a disenchanter.

==Strategy==
Disenchanters are a nightmare to face in close combat due to their very good [[AC]] of -10. The disenchanting claw attack is subject to [[magic cancellation]]; having MC3 through a [[cloak of protection]] or other means will reduce the probability of your armor losing enchantment, but does not prevent the [[passive]] disenchanting attack. However, disenchanters have [[Magic resistance (monster)|0 MR]], leaving them completely vulnerable to magical effects such as [[polymorph]], [[cancellation]], and [[sleep]], and they can be easily warded off using instruments such as a [[tooled horn]] or [[leather drum]] to scare them. [[Attack spell]]s and [[wand]]s can keep them at bay with far less risk to your armor, though their AC will make landing shots a significant problem.

The "simplest" method of killing a disenchanter is to solely use unenchanted weapons such as weapon-tools like [[pick-axe]]s or [[unicorn horn]]s, unless you are actively using them as your main weapon; secondary starting weapons that went mostly unused may also prove a viable backup if you kept them around. If you have immobilized a disenchanter, or else armor enchantment is not a pressing issue for you, you can also remove your [[gloves]] to preserve their enchantment and bash it to death with your bare hands. ([[Monk]]s aiming to [[kick]] one to death will also want to mind the enchantment of their [[boots]]). Similarly, strong pets that do not rely on weapons or else are wielding unenchanted ones will have no trouble against them.

Disenchanters are often a common target for single-species [[genocide]], as rust monsters are not much of a threat once the player reaches Gehennom. However, they can also be useful to roles who cannot reliably cast [[drain life]], providing an alternate method to selectively reduce the enchantment on a wielded weapon or piece of armor (by wielding the item and hitting the disenchanter with it) so it can be re-enchanted to a higher level.

==Origin==
The disenchanter is a monster that originates in ''[[Dungeons & Dragons]]'', making its debut in the 1st edition ''Fiend Folio'' and issue  #6 of ''White Dwarf''. It is often described as a blue-furred quadrupedal creature with an elephant-like trunk and a camel-esque body and "hump". Disenchanters are considered even more infamous in tabletop settings, not solely for their magic-eating abilities, but also for their somewhat goofy-looking designs.

==History==
The disenchanter was added in [[NetHack 3.3.0]].

==Variants==
===SLASH'EM===
In [[SLASH'EM]], disenchanter corpses are safe to eat. Additionally, they are no longer the only monster that can disenchant weapons and armor with the addition of the [[Golem (SLASH'EM)#Steel golem|steel golem]], which has also a passive disenchanting attack.

===UnNetHack===
In [[UnNetHack]], eating a disenchanter corpse has a 50% chance of removing a random intrinsic, in a way similar to being hit by a [[gremlin]] at night. While potentially dangerous, this could also potentially be used to get rid of harmful intrinsics gained accidentally.

== Encyclopedia entry ==
{{encyclopedia|
Ask not, what your magic can do to it. Ask what it can do to your magic.
}}

[[Category:Monsters]]
{{nethack-366}}}
&&%s&& %s Deities {8157 2006-08-24T01:06:35Z {239 Eidolos} Redirect to [[God]]. #REDIRECT [[God]]}
&&%s&& %s Dieties {8158 2006-08-24T01:06:48Z {239 Eidolos} Redirect to [[God]]. #REDIRECT [[God]]}
&&%s&& %s Deity {8159 2006-08-24T01:07:14Z {239 Eidolos} Redirect to [[God]]. #REDIRECT [[God]]}
&&%s&& %s Diety {8160 2006-08-24T01:07:29Z {239 Eidolos} Redirect to [[God]]. #REDIRECT [[God]]}
&&%s&& %s Gods {8161 2006-08-24T01:07:47Z {239 Eidolos} Redirect to [[God]]. #REDIRECT [[God]]}
&&%s&& %s W343-3 {127581 2019-08-30T02:28:19Z {679 Ray Chason} All users of 3.4.3 on Windows 10 should patch for this bug {|style="width:100%"
|-valign="top"
|'''W343-3''' designates a [[bugs in NetHack 3.4.3#W343-3|bug]] that affects the [[Microsoft Windows]] version of [[NetHack 3.4.3]].  It is fixed in [[NetHack 3.6.0]].  The bug is listed as:

<poem style="border: 1px dashed #2f6fab;background-color: #f9f9f9; padding:0.5em">
<tt>Under the Polish version of Windows 2000 SP4, screen output with a raster font shows wrong characters for many dungeon features</tt></poem>

__TOC__
|{{patch
 |name=Win32 locales fix
 |author=Ray Chason
 |download=http://bilious.alt.org/?download=313
 |bilious=313
}}
|}

== Nature of the bug ==

The bug has been reported on [http://groups.google.com/group/rec.games.roguelike.nethack/browse_thread/thread/4ba778741135464e Polish] and Russian editions of Windows 2000 and on a [http://groups.google.com/group/rec.games.roguelike.nethack/browse_thread/thread/8eea5ab560b85b7b Czech] version of Windows XP.  It has been [http://groups.google.com/group/rec.games.roguelike.nethack/browse_frm/thread/6bd4af64d16878f6 duplicated] on an American Windows XP by changing a language setting.  A [http://amiro.republika.pl/nethack/screen1.png screenshot] is available.

Bug W343-3 really comprises two distinct and unrelated bugs.  One is a simple character set issue:  many non-USA PCs are configured with different character sets, and seven symbols may look different.  This issue is more fully detailed in the [[IBMgraphics]] article.

The more serious bug is that some characters appear as strange symbols or blank squares.  This is not actually a bug in NetHack, but in Windows.  The rest of this article will deal with this bug.

== Cause of the bug ==

The bug is a flaw in the Windows WriteConsoleOutputCharacterA API.  When its configured code page is other than 437 or 850, many non-[[ASCII]] characters can show up incorrectly.

The bug occurs when four conditions are met:

* The version of Windows is Windows NT or one of its descendants, no later than Windows 8.1.  The bug is confirmed to exist on Windows 2000, Windows XP, Windows Vista, Windows 7, Windows 8 and Windows 8.1. It is confirmed to be fixed on Windows 10 (but see the note below on Windows 10).
* The built-in command shell window is used. Alternate command shell windows are available; [http://cmder.net/ Cmder], in particular, is confirmed ''not'' to have the bug.
* A bitmap font, rather than Lucida Console, is selected.
* The command shell is running in a window, rather than full screen.  Windows Vista and later do not support full screen mode in the console, and so this item will always be true for those versions of Windows.
* The language for non-Unicode programs is set to one whose OEM [[wikipedia:code page|code page]] is anything ''other'' than [[wikipedia:code page 437|437]] or  [[wikipedia:code page 850|850]].  Basically this means any East European language, whether it uses Greek, Cyrillic or Latin writing.

No API other than WriteConsoleOutputCharacterA is known to be affected.  In particular, the Unicode variant WriteConsoleOutputCharacterW works correctly.

=== Windows 10 ===

The Windows terminal program changed in Windows 10. The changed fixed the original W343-3 problem, but certain characters on the [[Rogue level]] may not display correctly. Specifically, the characters that have code points less than 0x20 display as empty boxes. See [[IBMgraphics]] for more details.

This bug appears when the terminal program is ''not'' in legacy mode and when a TrueType font is selected.

This bug is only loosely related to W343-3, but the fix in the code is the same. All users of Windows 10 running NetHack 3.4.3, regardless of locale, can benefit from the W343-3 patch.

== Versions affected ==

[[NetHack 3.4.3]] is known to have this bug.  Because [[NetHack 3.1.1]] through [[NetHack 3.1.3|3.1.3]] also use the flawed API, it is likely that they have it as well.  [[NetHack 3.2.0]] through [[NetHack 3.4.2|3.4.2]] use different APIs, and do not have this bug.

The [[Curses interface]] is not affected, even when linked with PDCurses for the Win32 console, because PDCurses does not uses the offending API.

== Patch ==

The bug is fixed in [[NetHack 3.6.0]]. A [[patch]] is available to fix this bug in [[NetHack 3.4.3]]; but no binaries or variants other than [[Spanish NetHack]] are known to incorporate it.

The patch fixes the API issue by detecting when it is running on an NT-based version of Windows, and using the Unicode API instead, avoiding the Windows bug.  It fixes the character set issue as well (see [[IBMgraphics]]) by allowing less-extensive variants of IBMgraphics to be set, avoiding the characters that can vary among code pages.

The patch was posted to [[rec.games.roguelike.nethack]] as four articles:

* [http://groups.google.com/group/rec.games.roguelike.nethack/browse_thread/thread/65e249e2c8e48115 Part 1] describes the API issue and provides detailed instructions to duplicate it, and a small test program to demonstrate the bug.
* [http://groups.google.com/group/rec.games.roguelike.nethack/browse_thread/thread/2c4e9391e6da19bc Part 2] describes the character set issue.
* [http://groups.google.com/group/rec.games.roguelike.nethack/browse_thread/thread/1634242b9cc429e2 Part 3] contains the patch itself.
* [http://groups.google.com/group/rec.games.roguelike.nethack/browse_thread/thread/8abe3cd0e85e5a09 Part 4] is a description of each change the patch makes.

The [[Bilious Patch Database]] has a simpler form of this patch, that works around the faulty API but does not alter the IBMgraphics, [http://bilious.alt.org/?313 here].  This patch also fixes [[W343-4]].

{{noversion}}<!--historic-->
[[Category:Bugs]]}
&&%s&& %s W343-4 {110361 2018-05-13T15:43:11Z {679 Ray Chason} Bug W343-4 is fixed in 3.6.1 {{patch
 |name=Win32 locales fix
 |author=Ray Chason
 |download=http://bilious.alt.org/?download=313
 |bilious=313
}}
'''W343-4''' designates a [[Bugs in NetHack 3.4.3#W343-4|bug]] that affects the [[Microsoft Windows]] version of [[NetHack 3.4.2]], [[NetHack 3.4.3|3.4.3]] and [[NetHack 3.6.0|3.6.0]].  It occurs when the keyboard handler [[nhraykey.dll]] is loaded and causes minor problems with the keyboard when performing certain acts, such as locking a [[door]].

A [[patch]] is available to fix this bug at the [[Bilious Patch Database]], [http://bilious.alt.org/?313 here]; it also fixes [[W343-3]].  Although the [[DevTeam]] lists this bug as fixed in the next release, it is ''not'' fixed in [[NetHack 3.6.0]]. It is fixed in [[NetHack 3.6.1]].<ref>[https://github.com/NetHack/NetHack/commit/78857961d2b40f01516ec3ecdafd348c79142bbc#diff-fa02d0cc210b095a04eaed9c7fbbd331 DevTeam GitHub repository, commit 7885796.]</ref>

== Nature of the bug ==

Bug W343-4 affects all users of NetHack on Windows who use the text mode [[user interface]] and the keyboard handler nhraykey.dll.

After performing any act that takes multiple turns and can be interrupted, such as locking a [[door]], the game seems to stop responding.  It is necessary to press a key to get it to continue.  

This bug is an annoyance rather than a showstopper, but has perhaps slowed the acceptance of nhraykey.dll, despite its improved handling of non-USA (and especially non-English) keyboards.

== Cause of the bug ==

Nhraykey.dll seeks to read both keyboard and mouse input, while translating the keystrokes according to the user's configured localization settings.  The Win32 API does not make this task easy:  ReadConsole translates the keystrokes, but ignores the mouse, while ReadConsoleInput reads the mouse, but does not translate the keystrokes.  Nhraykey.dll solves this problem by calling PeekConsoleInput first, and then calling ReadConsole to retrieve any keystrokes and ReadConsoleInput to clear out anything else.

The complication is that there can be a keystroke, but the call to ReadConsole may still block, keeping the mouse from responding, because the key was a [[wikipedia:dead key|dead key]].  Nhraykey.dll prevents the blocking by pushing a bogus key event on the queue before calling ReadConsole; if nothing else, the ReadConsole call will return the bogus key.

The bogus key is supposed to be ignored when it is read.  The bug is that one particular function, NHkbhit(), doesn't do this.  It returns a true status, indicating that a real key is available, and allmain.c then calls Getchar() to retrieve this nonexistent key.  The user must eventually provide a real key for Getchar() to return.

== Versions affected ==

The versions affected are [[NetHack 3.4.2]], [[NetHack 3.4.3]] and [[NetHack 3.6.0]].

== Patch ==

A [[patch]] is available to fix this bug, as [http://groups.google.com/group/rec.games.roguelike.nethack/browse_frm/thread/e92013db64618fe3 this post] to [[rec.games.roguelike.nethack]].  The patch is against [[NetHack 3.4.3]] and may or may not apply cleanly to [[NetHack 3.6.0]].  No binaries or variants other than [[Spanish NetHack]] are known to incorporate the pach.

The fix is to add a check for the bogus key in NHkbhit().  If found, the bogus key is discarded and the queue is queried again.

== References ==
<references/>

{{noversion}}
[[Category:Bugs]]}
&&%s&& %s Nhraykey.dll {146101 2022-06-05T23:05:25Z {679 Ray Chason} Note merger of nh*key.dll to main binary in 3.7 '''Nhraykey.dll''' is a keyboard handler for the [[Microsoft Windows]] text-mode version of [[NetHack 3.4.3]].  Its purpose is to improve handling of keyboards with non-USA layouts.

This is a separate DLL in NetHack 3.4.2 through 3.6.6. In the current development version, it is merged into the main binary, along with its alternatives, nhdefkey.dll and nh340key.dll.

== How it works ==

NetHack wants both keyboard and mouse input, but the Win32 console APIs provide no easy way of getting mouse input and also translating keystrokes according to the user's locale.  The ReadConsole API retrieves keystrokes and translates them properly, but discards mouse events.  The ReadConsoleInput API retrieves key and mouse events but does not translate the keys.

[[NetHack 3.4.1]] attempted to solve this problem by reading all input with ReadConsoleInput and passing it to the ToAscii API.  The default keyboard handler, [[nhdefkey.dll]], still works this way.  This approach, however, only seems to work with USA keyboards.  With others, it ends up using the USA layout, and the user is likely to find this confusing.

Nhraykey.dll takes a different approach.  First, it notes that commands have different needs from prompts:
* When NetHack is waiting for a command, such as (d)rop or one of the hjklyubn keys, it wants any of three kinds of input:  an [[ASCII]] character, a character with the eighth bit set to indicate an Alt sequence, or a mouse event.  We do not want to send a non-ASCII character except in response to an Alt sequence, else the game might give surprising behavior, even accidentally invoking the #[[quit]] command.
* When NetHack has prompted for text, the mouse is unimportant, and we don't want Alt sequences; but we do want any character that the user can type, ASCII or not.

So it separates these two functions, which had previously been one, and solves the problem according to the needs of each mode.  For a command, it first uses PeekConsoleInput to determine what type of input is available.  For a key event, it goes to ReadConsole to retrieve the key properly translated.  For a mouse event, it goes to ReadConsoleInput to fetch the event.

The idea is never to call ReadConsole when a mouse event is important, unless we can be sure that it will not block; if that happened, the mouse would cease to function until it returned.  ReadConsole is prevented from blocking by pushing a bogus key event on the queue; if there's nothing else for ReadConsole to fetch, it will fetch the bogus key.  The bogus key is constructed so that it does not match any real key event, and can be filtered out.

For prompts, ReadConsole is used directly, because mouse events are not needed.

== Bug W343-4 ==

{{main|W343-4}}

There is one point at which the unmodified nhraykey.dll needs to filter the bogus key, but fails to do so.  This can result in ReadConsole being called and blocking because there is no real key for it to read.  A [[patch]] is available to fix this bug in 3.4.3, and it is fixed in 3.6.1.<ref>[https://github.com/NetHack/NetHack/commit/78857961d2b40f01516ec3ecdafd348c79142bbc#diff-fa02d0cc210b095a04eaed9c7fbbd331 DevTeam GitHub repository, commit 7885796.]</ref>

== Further reading ==

[http://groups.google.com/group/rec.games.roguelike.nethack/browse_frm/thread/76c79f23e56a210f The patch] against [[NetHack 3.4.1]] that became nhraykey.dll.

[http://groups.google.com/group/rec.games.roguelike.nethack/browse_frm/thread/5218c0df964795f7 Description] of the patch.

[http://groups.google.com/group/rec.games.roguelike.nethack/browse_frm/thread/e92013db64618fe3 Fix] for bug W343-4.

== References ==
<references/>

[[Category:Annotations]]
{{nethack-361}}}
&&%s&& %s Silver dragon {147607 2022-08-16T13:07:52Z {4000251 Netzhack} /* Encyclopedia entry */ Soften line breaks {{monster
 |name=silver dragon
 |symbol={{monsym|silver dragon}}
 |tile=[[Image:Silver dragon.png|Adult silver dragon]]
 |difficulty=20
 |level=15
 |experience=460
 |speed=9
 |AC=-1
 |MR=20
 |align=4 
 |frequency=1
 |genocidable=Yes
 |attacks=Breath 4d6 cold, bite 3d8, claw 1d4, claw 1d4
 |weight=4500
 |nutr=1500
 |size=Gigantic
 |resistances=[[Cold]]
 |resistances conveyed=None
 |attributes={{attributes|A silver dragon|fly=1|thick=1|nohands=1|seeinvis=1|oviparous=1|carnivore=1|hostile=1|strong=1|nasty=1|greedy=1|jewels=1|magic=1}}
 |reference=[[monst.c#line1161]]
}}
{{monster
 |name=baby silver dragon
 |symbol={{monsym|baby silver dragon}}
 |tile=[[Image:Baby silver dragon.png|Baby silver dragon]]
 |difficulty=13
 |level=12
 |experience=200
 |speed=9
 |AC=2
 |MR=10
 |align=0
 |frequency=0
 |genocidable=Yes
 |attacks=Bite 2d6
 |weight=1500
 |nutr=500
 |size=Huge
 |resistances=[[Cold]]
 |resistances conveyed=None
 |attributes={{attributes|A baby silver dragon|fly=1|thick=1|nohands=1|carnivore=1|hostile=1|strong=1|greedy=1|jewels=1}}
 |reference=[[monst.c#line1085]]
}}

The '''silver dragon''', {{monsym|silver dragon}}, is a [[monster]] that appears in ''[[NetHack]]''. It has a younger form in the '''baby silver dragon''', {{monsym|baby silver dragon}}. The silver dragon has intrinsic [[cold resistance]] and [[reflection]], and its breath weapon fires rays of [[cold|frost]]. Its corpse does not convey any intrinsics.

==Generation==
{{main|Dragon#Generation}}
Players will not see baby silver dragons through normal random [[monster creation]] outside of [[Monster frequency|aligned branches]] and levels such as the [[Oracle]] and [[Sokoban]], and they can also be hatched from dragon [[egg]]s. Adult silver dragons start appearing around the middle depths of the dungeon. Silver dragons can be generated in [[throne room]]s as early as dungeon level 15, and may appear when a [[throne]] at this depth or lower is [[loot]]ed.{{reffunc|mkroom.c|courtmon}} Silver dragons can also be created if a lawful spellcaster casts the [[summon nasties]] [[monster spell]].

Silver dragons have a {{frac|3}} of dropping a set of +0 uncursed [[silver dragon scales]] along with their [[corpse]] ({{frac|20}} if the dragon was [[revive]]d).

==Strategy==
:''See also: [[Dragon#Strategy]]''
The silver dragon's reflective scales protect it from the rays of spells and wands, severely reducing the amount of options ranged and otherwise that a player has against it. However, it has no other resistances besides cold resistance, and its low [[monster magic resistance]] can still be used to bring it down. Wielded or thrown potions such as [[potion of sleeping|sleeping]] can immobilize them or else soften them up for melee or peppering with projectiles, but care should be taken not to have them destroyed by cold breath. The reflective power of their scales also makes them a common target for [[reverse genocide]] by players seeking [[silver dragon scale mail]]; this is usually to complement a [[cloak of magic resistance]] or any [[magic resistance]] source they own or plan to obtain, as well as protecting their inventory from item-destroying rays.

As pets and steeds, silver dragons sometimes compete with [[gray dragon]]s - both possess flight, useful breath weapons and immunity to death rays. The silver dragon has the added perk of being completely immune to elemental rays by virtue of reflecting them, which can also kill the attacker if the ray came from a wand. Its breath can also bridge [[moat]]s for later crossing, though the ice will not always persist. Unfortunately, on top of low speed and lack of other resistances that can work against them, they can also fall victim to [[poison]] or [[polymorph trap]]s - the gray dragon's scales at least give it a means of protection against the latter. There are also many faster and/or stronger steed than dragons in general, though most such choices lack reflection of their own.

==History==
The silver dragon, its baby form and silver dragon scales were introduced to the vanilla series in [[NetHack 3.3.0]]. Before that, it first appeared in the [[3.1.3]] variant [[SLASH 6]].

==Variants==
{{main|Dragon#Variants}}
Variants of ''NetHack'' often subject dragons to extensive changes, including the silver dragon.

===Biodiversity patch===
In the [[biodiversity patch]], the silver dragon is renamed to the '''amphitere'''.

===SLASH'EM===
{{main|Dragon (SLASH'EM)}}
As with all other dragons in SLASH'EM, baby silver dragons have a base level of 4 instead of 12, and can be encountered via random generation in ordinary levels with a frequency of 2 - they are also eligible for creation on many levels that generate random {{white|D}} on level creation. Adult silver dragons have a base level of 18 instead of 15.

Unlike most other dragons, baby and adult silver dragons do not hit as a +1 or +3 weapon respectively. Adult silver dragons will not turn [[traitor]] while tame.

===UnNetHack===
In [[UnNetHack]], all dragons have their breaths, resistances, and colors randomized, allowing any non-[[chromatic dragon (UnNetHack)|chromatic dragon]] to appear as silver.

===dNetHack===
In [[dNetHack]], silver dragons are the only source of reflection that can withstand a dragon's breath attack.

==Encyclopedia entry==
{{encyclopedia|<poem>
In the West the dragon was the natural enemy of man.  Although preferring to live in bleak and desolate regions, whenever it was seen among men it left in its wake a trail of destruction and disease.  Yet any attempt to slay this beast was a perilous undertaking.  For the dragon's assailant had to contend not only with clouds of sulphurous fumes pouring from its fire breathing nostrils, but also with the thrashings of its tail, the most deadly part of its serpent-like body.
{{right-align|[ Mythical Beasts by Deirdre Headon (The Leprechaun Library) ]}}

"One whom the dragons will speak with," he said, "that is a dragonlord, or at least that is the center of the matter.  It's not a trick of mastering the dragons, as most people think. Dragons have no masters.  The question is always the same, with a dragon:  will he talk to you or will he eat you?  If you can count upon his doing the former, and not doing the latter, why then you're a dragonlord."
{{right-align|[ The Tombs of Atuan, by Ursula K. Le Guin ]}}
</poem>}}

==References==
<references/>
{{nethack-366}}
[[Category:Monsters]]}
&&%s&& %s Black dragon {147603 2022-08-16T13:05:03Z {4000251 Netzhack} /* Encyclopedia entry */ Softer line breaks {{monster
 |name=black dragon |symbol={{monsym|black_dragon}}
 |tile=[[Image:Black dragon.png|Black dragon]]
 |difficulty=20
 |level=15
 |experience=460
 |speed=9
 |AC=-1
 |MR=20
 |align=-6
 |frequency=1
 |genocidable=Yes
 |attacks=Breath disintegration, bite 3d8, claw 1d4, claw 1d4
 |weight=4500
 |nutr=1500
 |size=Gigantic
 |resistances=Disintegration
 |resistances conveyed=[[Disintegration resistance]] (100%)
 |attributes={{attributes|A black dragon|fly=1|thick=1|nohands=1|seeinvis=1|oviparous=1|carnivore=1|hostile=1|strong=1|nasty=1|greedy=1|jewels=1|magic=1}}
 |reference=[[monst.c#line1161]]
}}
{{monster
 |name=baby black dragon
 |symbol={{monsym|baby_black_dragon}}
 |tile=[[Image:Baby black dragon.png|Baby black dragon]]
 |difficulty=13
 |level=12
 |experience=200
 |speed=9
 |AC=2
 |MR=10
 |align=0
 |frequency=0
 |genocidable=Yes
 |attacks=Bite 2d6
 |weight=1500
 |nutr=500
 |size=Huge
 |resistances=''Disintegration
 |resistances conveyed=None
 |attributes={{attributes|A baby black dragon|fly=1|thick=1|nohands=1|carnivore=1|hostile=1|strong=1|greedy=1|jewels=1}}
 |reference=[[monst.c#line1085]]
}}

The '''black dragon''', {{monsym|black dragon}}, is a [[monster]] that appears in ''[[NetHack]]''. It has a younger form in the '''baby black dragon''', {{monsym|baby black dragon}}. The black dragon has [[disintegration resistance]] both intrinsically and from its scales, and its breath weapon fires rays of [[disintegration]]. It is the only guaranteed source of [[disintegration resistance]] in the game.

==Generation==
{{main|Dragon#Generation}}
Players will not see baby black dragons through normal random [[monster creation]] outside of the [[Oracle]] and [[Sokoban]] levels; adult black dragons start appearing around the midway depths of the dungeon. Black dragons can be generated in [[throne room]]s as early as dungeon level 15, and may appear when a [[throne]] at this depth or lower is [[loot]]ed.{{reffunc|mkroom.c|courtmon}} Black dragons can be created if a chaotic spellcaster casts the [[summon nasties]] [[monster spell]].

Black dragons have a {{frac|3}} probability of dropping a set of +0 uncursed [[black dragon scales]] along with their [[corpse]] ({{frac|20}} if the dragon was [[revive]]d).

==Strategy==
Taking on a black dragon is an especially perilous endeavor - the ray can only be protected against either through [[reflection]] or disintegration resistance, and the latter is most easily obtained by either eating black dragon meat or wearing its scales. If a dragon's blast of disintegration hits a monster, including you, that is neither resistant nor reflecting, it destroys objects in the following order:{{refsrc|zap.c|3686|nethack=3.6.1}}{{refsrc|zap.c|3542|nethack=3.6.1}}

# Any worn [[shield]].
# Any worn body armor, including [[cloak]]s.
# A worn [[amulet of life saving]]; this only applies in corner cases where a living monster wearing an amulet has been [[polymorph]]ed into a form the amulet would not work on. Otherwise, it functions as normal.
# [[instadeath|The victim]] in question. The rebound can still disintegrate the target if their gear saved them from the direct hit.

This makes the black dragon incredibly dangerous to engage at any non-melee distance within its line-of-fire, especially in unlit areas such as [[Fort Ludios]]. While it thankfully lacks any other resistances, care still has to be taken during combat - players who lack a source of reflection should avoid being caught down the hall from one. The breath weapon can be avoided either by trying to lure it close, or else using (very) fast [[speed]] in order to close the gap while avoiding the line of fire as much as possible. Eating black dragon meat or obtaining its scales ensures that disintegration will no longer be an issue for you during the rest of that game unless the property is lost, though you will still want to keep pets from being reduced to ash if possible.

The black dragon is often sought out as a pet, or more frequently used as a [[Polyself|polyform]], in order to dispatch particularly nasty foes who otherwise lack disintegration resistance. A [[Monk]] not doing polyselfless can use the form of a black dragon to evaporate [[Master Kaen]] without him reaching striking distance; [[Samurai]] can use the pet or polyform to engage and kill [[Ashikaga Takauji]] without risk of death by bisection (especially since dragons are too large to be instakilled this way). Disintegrating a quest nemesis will not destroy the [[quest artifact]] or the [[Bell of Opening]].

==History==
[[NetHack 2.3e]] introduces the black dragon along with all of the other modern dragon types (and their breath weapons) except for silver. In this version, Black dragonbreath instakills the player, and there is no means of reflection, disintegration resistance, or amulet of life saving - the temptation of genocide must be balanced with the fact that dragons of any color are a guaranteed source of [[fire resistance]], which is absolutely necessary to enter [[Hell]]; there is no means to genocide only black dragons.

[[NetHack 3.0.0]] introduces baby black  dragons alongside the other baby dragons. This version also distinguishes all color dragons, their younger stages and their corpses, and introduces dragon scale mail. In addition, reflection is now available and black dragon breath is toned down slightly; it also becomes possible to genocide ''only'' black dragons, ensuring that sources of fire resistance remained.

[[NetHack 3.1.0]] introduces black dragon scales along with the other colors, as well as the current method of obtaining dragon scale mail.

...through normal random [[monster creation]] outside of [[Monster frequency|aligned branches]] and levels such as the [[Oracle]] and [[Sokoban]], and they can also be hatched from dragon [[egg]]s. Adult...

==Variants==
Variants of ''NetHack'' often subject dragons to extensive changes, including the black dragon.

===Biodiversity patch===
In the [[biodiversity patch]], the black dragon is renamed to the '''sirrush'''.

===SLASH'EM===
{{Main|Dragon (SLASH'EM)}}
As with all other dragons in SLASH'EM, baby black dragons have a base level of 4 instead of 12, and can be encountered via random generation in ordinary levels with a frequency of 2; they are also eligible for creation on many levels that generate random {{white|D}} on level creation. Adult black dragons have a base level of 18 instead of 15.

Baby black dragons hit as a +1 weapon, and adult black dragons hit as a +3 weapon. Adult black dragons have a chance to turn [[traitor]] while tame.

===UnNetHack===
In [[UnNetHack]], all dragons have their breaths, resistances, and colors randomized, allowing any non-[[chromatic dragon (UnNetHack)|chromatic dragon]] to appear as black.

==Encyclopedia entry==
